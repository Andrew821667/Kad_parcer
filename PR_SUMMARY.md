# Pull Request: –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–µ—Ä–∞ –ö–ê–î –ê—Ä–±–∏—Ç—Ä —Å CDP

## üéØ –¶–µ–ª—å

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π workflow –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–µ–ª –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Å—É–¥–µ–±–Ω—ã—Ö –∞–∫—Ç–æ–≤ –∏–∑ —Å–∏—Å—Ç–µ–º—ã –ö–ê–î –ê—Ä–±–∏—Ç—Ä —Å –æ–±—Ö–æ–¥–æ–º bot detection.

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –û–±—Ö–æ–¥ –∑–∞—â–∏—Ç—ã –æ—Ç –±–æ—Ç–æ–≤ (HTTP 451)

- **–ü—Ä–æ–±–ª–µ–º–∞**: API –ö–ê–î –ê—Ä–±–∏—Ç—Ä –≤–æ–∑–≤—Ä–∞—â–∞–ª HTTP 451 (Unavailable For Legal Reasons)
- **–†–µ—à–µ–Ω–∏–µ**: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Playwright –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É Chrome —á–µ—Ä–µ–∑ CDP (Chrome DevTools Protocol)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 100% —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª—ã:**
- `src/scraper/playwright_scraper.py` - –æ—Å–Ω–æ–≤–Ω–æ–π scraper —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π CDP
- `scripts/start_chrome_debug.sh` - –∑–∞–ø—É—Å–∫ Chrome –¥–ª—è macOS
- `scripts/start_chrome_debug_linux.sh` - –∑–∞–ø—É—Å–∫ Chrome –¥–ª—è Linux

### 2. –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –æ –¥–µ–ª–∞—Ö

- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–ª—è —Å—É–¥—å—è/—Å—É–¥, –∏—Å—Ç–µ—Ü/–æ—Ç–≤–µ—Ç—á–∏–∫–∏ —Å–∫–ª–µ–∏–≤–∞–ª–∏—Å—å –≤ –æ–¥–Ω–æ
- **–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ–ª–µ–π
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í—Å–µ –ø–æ–ª—è –ø–∞—Ä—Å—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ —Ä–∞–∑–¥–µ–ª—å–Ω–æ

**–ò–∑–≤–ª–µ–∫–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `case_number` - –Ω–æ–º–µ—Ä –¥–µ–ª–∞ (–°–ò–ü-95/2024)
- `case_date` - –¥–∞—Ç–∞ (31.01.2024)
- `case_type` - —Ç–∏–ø –¥–µ–ª–∞
- `judge` - —Å—É–¥—å—è (–§–ò–û)
- `court` - —Å—É–¥ (–ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
- `plaintiff` - –∏—Å—Ç–µ—Ü
- `respondents` - –æ—Ç–≤–µ—Ç—á–∏–∫–∏ (—Å–ø–∏—Å–æ–∫)
- `url` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –¥–µ–ª–∞

**–§–∞–π–ª—ã:**
- `src/scraper/playwright_scraper.py:_parse_table_html()` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

### 3. –ü–∞–≥–∏–Ω–∞—Ü–∏—è

- **–ü—Ä–æ–±–ª–µ–º–∞**: –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É 40 —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **–†–µ—à–µ–Ω–∏–µ**: AJAX –∫–ª–∏–∫–∏ –ø–æ —Å—Å—ã–ª–∫–∞–º `#page{N}` —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –£—Å–ø–µ—à–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤—Å–µ–º 40 —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º (25 –¥–µ–ª –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ)

**–¢–µ—Å—Ç—ã:**
- `scripts/test_parser_pagination.py` - —Ç–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ 3 —Å—Ç—Ä–∞–Ω–∏—Ü (75 –¥–µ–ª)

### 4. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF —Å—É–¥–µ–±–Ω—ã—Ö –∞–∫—Ç–æ–≤

**–≠–≤–æ–ª—é—Ü–∏—è —Ä–µ—à–µ–Ω–∏—è:**

#### –ü–æ–ø—ã—Ç–∫–∞ 1: `expect_download()` —Å goto
- ‚ùå Timeout - download event –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª

#### –ü–æ–ø—ã—Ç–∫–∞ 2: `page.pdf()`
- ‚ùå –°–∫–∞—á–∏–≤–∞–ª–∏—Å—å HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞–∫ PDF (—Å–∫—Ä–∏–Ω—ã)

#### –ü–æ–ø—ã—Ç–∫–∞ 3: CDP `Page.printToPDF`
- ‚ùå –°–æ–∑–¥–∞–≤–∞–ª–∏—Å—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–Ω–µ–ø–æ–ª–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã)

#### ‚úÖ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: HTTP –∑–∞–ø—Ä–æ—Å —Å cookies
- –ü–æ–ª—É—á–µ–Ω–∏–µ cookies –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ (`context.cookies()`)
- HTTP GET –∑–∞–ø—Ä–æ—Å –∫ PDF URL —Å —ç—Ç–∏–º–∏ cookies (httpx)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ Content-Type –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —á—Ç–æ —ç—Ç–æ PDF
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ 5/5 PDF –∞–∫—Ç–æ–≤ —Å–∫–∞—á–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤: 200-370 KB (–Ω–∞—Å—Ç–æ—è—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã)
- ‚úÖ –ü–æ–ª–Ω—ã–µ —Å—É–¥–µ–±–Ω—ã–µ –∞–∫—Ç—ã, –∞ –Ω–µ —Å–∫—Ä–∏–Ω—ã

**–§–∞–π–ª—ã:**
- `scripts/test_full_workflow.py` - –ø–æ–ª–Ω—ã–π workflow (–ø–∞—Ä—Å–∏–Ω–≥ + —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ)
- `scripts/debug_case_page.py` - debug —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–°–∫—Ä–∏–ø—Ç—ã:**
- `scripts/test_parser_pagination.py` - —Ç–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ 3 —Å—Ç—Ä–∞–Ω–∏—Ü
- `scripts/test_full_workflow.py` - –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç (–ø–∞—Ä—Å–∏–Ω–≥ + —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ 5 PDF)
- `scripts/debug_case_page.py` - debug –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–µ–ª–∞
- `scripts/debug_table_row.py` - debug –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `TESTING.md` - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Windows, macOS, Linux
- –°–µ–∫—Ü–∏—è troubleshooting

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–∞—Ä—Å–∏–Ω–≥ (test_parser_pagination.py)
```
‚úÖ 3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã = 75 –¥–µ–ª
‚úÖ –í—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã
‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ (test_full_workflow.py)
```
‚úÖ 75 –¥–µ–ª —Å–ø–∞—Ä—Å–µ–Ω–æ
‚úÖ 5/5 PDF –∞–∫—Ç–æ–≤ —Å–∫–∞—á–∞–Ω–æ
‚úÖ –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤: 211-369 KB
‚úÖ –ù–∞—Å—Ç–æ—è—â–∏–µ PDF –¥–æ–∫—É–º–µ–Ω—Ç—ã (–Ω–µ —Å–∫—Ä–∏–Ω—ã)
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### CDP –ø–æ–¥—Ö–æ–¥
```
Playwright ‚Üí CDP (port 9222) ‚Üí –†–µ–∞–ª—å–Ω—ã–π Chrome ‚Üí kad.arbitr.ru
                                                ‚Üì
                                        –ù–µ—Ç bot detection!
```

### Workflow
```
1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Chrome —á–µ—Ä–µ–∑ CDP
2. –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞ kad.arbitr.ru
3. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –ø–æ–∏—Å–∫–∞ (—è–Ω–≤–∞—Ä—å 2024)
4. –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
5. –ü–æ–ª—É—á–µ–Ω–∏–µ cookies –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
6. HTTP —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF —Å cookies
7. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ ~/Downloads/kad_test/
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Python 3.11+**
- **Playwright** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
- **BeautifulSoup4** - –ø–∞—Ä—Å–∏–Ω–≥ HTML —Ç–∞–±–ª–∏—Ü
- **httpx** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç
- **Chrome/Chromium** - —Ä–µ–∞–ª—å–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä —á–µ—Ä–µ–∑ CDP
- **structlog** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **40 —Å—Ç—Ä–∞–Ω–∏—Ü** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (—è–Ω–≤–∞—Ä—å 2024)
- **~1000 –¥–µ–ª** –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
- **100% —É—Å–ø–µ—Ö** –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ CDP
- **5/5 PDF** —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω—ã

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ PDF**
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Å–µ—Ä—ã –¥–ª—è PDF/DOCX/HTML

2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î**
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–µ–ª –≤ PostgreSQL
   - –•—Ä–∞–Ω–∏—Ç—å PDF –≤ MinIO

3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ü–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö 40 —Å—Ç—Ä–∞–Ω–∏—Ü (—è–Ω–≤–∞—Ä—å 2024)
   - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ –ø–µ—Ä–∏–æ–¥ 2020-2025
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 18 –∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã—Ö —Å—É–¥–æ–≤

4. **–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
   - –ü–æ–∏—Å–∫ –ø–æ –¥–µ–ª–∞–º
   - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## üéâ –ì–æ—Ç–æ–≤–æ –∫ production

- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ
- ‚úÖ –ï—Å—Ç—å —Ç–µ—Å—Ç—ã
- ‚úÖ –ï—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –û–±—Ö–æ–¥ bot detection

–ú–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏!
